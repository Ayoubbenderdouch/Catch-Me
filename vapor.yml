id: 12345
name: catchme
environments:
  production:
    memory: 1024
    cli-memory: 512
    runtime: 'php-8.3:al2'

    build:
      - 'COMPOSER_MIRROR_PATH_REPOS=1 composer install --no-dev --optimize-autoloader'
      - 'php artisan event:cache'
      - 'npm ci && npm run build'

    deploy:
      - 'php artisan migrate --force'
      - 'php artisan storage:link'
      - 'php artisan config:cache'
      - 'php artisan route:cache'
      - 'php artisan view:cache'

    # Database Configuration
    database: catchme-production

    # Cache Configuration
    cache: catchme-cache

    # Queue Configuration
    scheduler: true
    queue: true

    # Domain Configuration
    # Update this with your actual domain
    domain: api.catchme.app

    # CORS Configuration for API
    cors: true

    # Environment Variables
    variables:
      APP_NAME: 'Catch Me'
      APP_ENV: production
      APP_DEBUG: false

      # Filesystem Configuration
      FILESYSTEM_DISK: public_direct

      # App Settings
      DEFAULT_MAX_DISTANCE: 50
      GHOST_MODE_ENABLED: true
      LOCATION_UPDATE_INTERVAL: 30

      # Locale Settings
      APP_LOCALE: fr
      APP_FALLBACK_LOCALE: ar

      # Session & Cache
      SESSION_DRIVER: database
      CACHE_DRIVER: redis
      QUEUE_CONNECTION: sqs

      # Sanctum Configuration
      SANCTUM_STATEFUL_DOMAINS: 'catchme.app,api.catchme.app,admin.catchme.app'

      # Logging
      LOG_CHANNEL: stack
      LOG_LEVEL: error

      # Security
      HASH_VERIFY: true
      BCRYPT_ROUNDS: 12

    # Auto-scaling Configuration
    auto-scaling:
      min: 1
      max: 5
      metric: 'requests'
      target: 70

    # Warm instances (keep 1 instance always ready)
    warm: 1

  staging:
    memory: 512
    cli-memory: 256
    runtime: 'php-8.3:al2'

    build:
      - 'COMPOSER_MIRROR_PATH_REPOS=1 composer install --optimize-autoloader'
      - 'npm ci && npm run build'

    deploy:
      - 'php artisan migrate --force'
      - 'php artisan storage:link'
      - 'php artisan config:cache'
      - 'php artisan route:cache'

    database: catchme-staging
    cache: catchme-staging-cache
    scheduler: true
    queue: false
    domain: staging-api.catchme.app
    cors: true

    variables:
      APP_NAME: 'Catch Me (Staging)'
      APP_ENV: staging
      APP_DEBUG: true
      LOG_LEVEL: debug
